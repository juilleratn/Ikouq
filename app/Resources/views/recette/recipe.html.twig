{% extends 'base.html.twig' %}
{% block title %}{{ recette.nom }}{% endblock %}
{% block body %}


    <div class="titre">
            <h1>{{ recette.nom }}</h1>
        </div>
    <div class="container">
        <div class="photo">
                <img style="width: 70%;height:75%;border-radius: 15px" src="/image/{{ recette.urlPhoto }}" alt="{{ recette.nom }}">
        </div>
            <div class="info">
                <div class="topbar">
                    <ul class="platRegime">
                        <li>{{ recette.plat }} /</li>
                        <li>{{ recette.regime }}(icone)</li>
                    </ul>
                </div>
                <div class="part">
                    <div class="pers">
                        <div class="moins">
                            Pour
                            <input type="button" id="moins" value="-" onclick="soustraire()"/>
                        </div>
                        <div id="nbPart">{{ recette.part }}</div>
                    </div>
                    <div class="plus">
                        <input type="button" id="plus" value="+" onclick="ajouter()"/> personnes (icone)
                    </div>
                    <div>{{ recette.duree }} minutes(icone duree)</div>
                    </div>
                </div>
    </div>
    <div class="hero">
        <div class="instruction">{{ recette.instruction }}</div>
        <div class="colonne_droite">
            <ul>
                <table>
                    <thead>
                    <tr>
                        <th>Photo</th>
                        <th>quantité/ingredient</th>
                        <th>allergene</th>
                        <th>Nutri-score</th>
                    </tr>
                    </thead>
                    <tbody>
                    {% for nom, value in quantitesIngredients %}
                        <tr>
                            <td><img style="width:75px; height:75px;border-radius: 15px" src="/image/{{ value.objet.urlPhoto }}"></td>
                            <td class="quantite" id="quant{{ loop.index - 1 }}" data-ing="{{ value.quantite }}">{{ value.quantite }} {{ value.objet.mesure }} de {{ nom }} </td>
                            <td>{% if (value.objet.allergene  == 'none') == false %}
                                {{ value.objet.allergene }}
                                {% endif %}</td>
                            <td>{% if (value.objet.nutriScore == '1') %}<img style="width:75px; height:75px;border-radius: 15px" src="{{ asset('NS_a.png') }}">A{% endif %}
                                {% if (value.objet.nutriScore == '2') %}<img style="width:75px; height:75px;border-radius: 15px" src="NS_b.png">B{% endif %}
                                {% if (value.objet.nutriScore == '3') %}<img style="width:75px; height:75px;border-radius: 15px" src="NS_c.png">C{% endif %}
                                {% if (value.objet.nutriScore == '4') %}<img style="width:75px; height:75px;border-radius: 15px" src="/NS_d.png">D{% endif %}
                                {% if (value.objet.nutriScore == '5') %}<img style="width:75px; height:75px;border-radius: 15px" src="/NS_e.png">E{% endif %}



                            </td>
                        </tr>
                    {% endfor %}
<script type="text/javascript">
    $nombrePart = {{ recette.part }};  // le nombre de part voulu au final
    $quantiteIngredient= $('.quantite');
    $recettePart = {{ recette.part }}; //le nombre de part à la base de la recette
    $resultatIngredient = [];

    i=0;
    j=0;
    $valueQ = [this.dataset.ing] ;

    //console.log($valueQ);

    function calculIngredient()  //  calcul de la quantite/part
    {
        $.each($quantiteIngredient, function(index)
        {
            $valueQ =
            //$resultatIngredient [i]= [(this.dataset.valueQ / $recettePart ) *$nombrePart];
            $resultatIngredient [i]= [($quantiteIngredient[index].firstChild.data / $recettePart ) *$nombrePart];
            i++;

        });console.log ('resulat', $resultatIngredient);
    }
     function fixeIngredient()  // inscris pour  la quantité de l'ingrédient
     {
         for(j=0;j<$resultatIngredient.length;j++){
             $('#quant'+j).html($resultatIngredient[j]);
         }
     }

    function ajouter()  // ajoute une part
    {
        $nombrePart++;
        $("#nbPart").html($nombrePart);
        $value = $("#nbPart").value;
        calculIngredient();
        fixeIngredient();
        i=0;
    }

    function soustraire() // enlève une part
    {
        if ($nombrePart <= 1) {
            $nombrePart = 1;
        }else{
            $nombrePart--;
            $("#nbPart").html($nombrePart);
            calculIngredient();
            fixeIngredient();
            i=0;
        }
    }
</script>
                    </tbody>
                </table>
            </ul>
        </div>
    </div>
    <div class="retour">
        <button type="button"><a href="javascript:history.go(-1)">Retour</a></button>
    </div>

{% endblock %}
